# 甘特图视图 (Timeline/Gantt View) - 功能说明

## ✨ 新增功能

为Bitable多维表格插件新增了**甘特图视图**，支持项目进度可视化管理！

## 📊 功能特性

### 1. 时间轴显示
- **三种时间刻度**：日、周、月视图切换
- **动态时间范围**：自动显示前后3个月的时间跨度
- **今日标记线**：红色竖线标记当前日期
- **灵活导航**：上月/下月快速切换，一键回到今天

### 2. 任务可视化
- **任务条显示**：横向条形图展示任务时间跨度
- **进度显示**：任务条内显示完成进度（深色覆盖）
- **分组展示**：按状态、优先级等字段自动分组
- **颜色区分**：根据分组字段的选项颜色自动着色

### 3. 交互功能
- **悬停提示**：鼠标悬停显示任务详细信息
  - 任务名称
  - 开始日期
  - 结束日期
  - 完成进度
- **横向滚动**：支持长时间跨度的任务展示
- **响应式设计**：自适应不同屏幕尺寸

### 4. 智能配置
甘特图视图支持以下配置项：
- **开始日期字段**：设置任务开始日期（必选）
- **结束日期字段**：设置任务结束日期（可选，默认使用开始日期）
- **标题字段**：设置任务名称显示字段
- **进度字段**：设置进度显示字段
- **分组字段**：按单选字段分组任务
- **时间刻度**：日/周/月显示

## 🎯 使用方法

### 1. 添加甘特图视图

在Bitable表格中点击 "+" 按钮，选择"甘特图视图"

### 2. 默认配置

创建时会自动配置：
- **开始日期字段**：`dueDate`（截止日期）
- **标题字段**：`name`（名称）
- **进度字段**：`progress`（进度）
- **分组字段**：`status`（状态）
- **时间刻度**：`day`（按日显示）

### 3. 查看任务
- 任务会按时间顺序横向排列
- 不同状态的任务用不同颜色区分
- 任务条的长度表示时间跨度
- 任务条内的深色部分表示完成进度

### 4. 时间导航
- 点击 **"上月"** / **"下月"** 按钮切换时间范围
- 点击 **"今天"** 按钮快速返回当前日期
- 点击 **"日/周/月"** 按钮切换时间刻度

## 🎨 UI 设计

### 布局结构
```
┌─────────────────────────────────────────────────────┐
│ [<] [今天] [>]  2026年1月        [日][周][月]      │
├─────────────┬───────────────────────────────────────┤
│  任务名称    │  时间轴刻度                           │
├─────────────┼───────────────────────────────────────┤
│  未开始     │  ──────────────────                   │
│  └ 任务1    │    ████████                          │
│  └ 任务2    │        ████████                      │
│  进行中     │  ──────────────────                   │
│  └ 任务3    │  ████████████                        │
│  已完成     │  ──────────────────                   │
│  └ 任务4    │    ████████                          │
└─────────────┴───────────────────────────────────────┘
```

### 视觉元素
- **任务条**：圆角矩形，半透明背景
- **进度条**：深色覆盖层
- **分组标签**：带颜色边框的徽章
- **今日线**：红色竖线
- **网格**：淡色分隔线

## 💡 使用场景

1. **项目管理**
   - 可视化项目时间线
   - 跟踪任务进度
   - 识别任务依赖关系

2. **团队协作**
   - 按成员分组查看任务
   - 统一时间视图
   - 快速识别资源冲突

3. **进度跟踪**
   - 直观展示完成情况
   - 识别延期任务
   - 规划未来工作

## 🔧 技术实现

### 核心技术
- **日期处理**：date-fns
- **时间计算**：differenceInDays, eachDayOfInterval
- **响应式布局**：Flexbox + 横向滚动
- **性能优化**：useMemo缓存计算结果

### 关键算法
```typescript
// 计算任务条位置
const calculateBarPosition = (record: Record) => {
  const daysSinceStart = differenceInDays(startDate, timeRange.start);
  const duration = differenceInDays(endDate, startDate) + 1;
  
  const left = daysSinceStart * columnWidth;
  const width = duration * columnWidth;
  
  return { left, width };
};
```

## 📝 代码文件

- **类型定义**：`src/types/index.ts` - 添加 `timelineConfig`
- **视图组件**：`src/bitable/views/TimelineView.tsx` - 甘特图实现
- **主视图**：`src/bitable/BitableView.tsx` - 集成甘特图视图
- **节点定义**：`src/bitable/bitable-node.ts` - 默认视图配置

## 🎉 功能完成度

- [x] 基础甘特图显示
- [x] 日/周/月时间刻度
- [x] 任务条位置计算
- [x] 进度显示
- [x] 分组功能
- [x] 今日标记
- [x] 悬停提示
- [x] 时间导航
- [x] 响应式设计
- [ ] 拖拽调整任务时间（计划中）
- [ ] 任务依赖关系（计划中）
- [ ] 里程碑标记（计划中）
- [ ] 批量编辑（计划中）

## 🚀 下一步优化

1. **交互增强**
   - 拖拽调整任务时间
   - 拖拽调整任务进度
   - 点击任务打开详情

2. **功能扩展**
   - 任务依赖关系连线
   - 里程碑节点显示
   - 关键路径高亮

3. **视觉优化**
   - 自定义任务条颜色
   - 条件格式化
   - 导出为图片

4. **性能优化**
   - 虚拟滚动（大量任务）
   - 懒加载
   - 缓存优化

---

**注意**：使用甘特图视图前，请确保至少有一个日期类型字段，否则无法正常显示任务！
