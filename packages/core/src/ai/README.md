# Editor Agent ä¼˜åŒ–æ–¹æ¡ˆæ€»è§ˆ

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

- **[å¤§æ–‡æ¡£ä¼˜åŒ–æ–¹æ¡ˆè¯¦è§£](./LARGE_DOCUMENT_OPTIMIZATION.md)** - æŠ€æœ¯å®ç°ç»†èŠ‚å’Œä¼˜åŒ–ç­–ç•¥
- **[åŸå§‹è®¾è®¡ vs ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”](./COMPARISON_EXAMPLE.md)** - å®é™…åœºæ™¯æ€§èƒ½å¯¹æ¯”
- **[é›†æˆæŒ‡å—](./INTEGRATION_GUIDE.md)** - å¿«é€Ÿé›†æˆåˆ°ç°æœ‰é¡¹ç›®

---

## ğŸ¯ é—®é¢˜æ¦‚è¿°

å½“å‰ `useEditorAgent` è®¾è®¡åœ¨å¤„ç†å¤§æ–‡æ¡£æ—¶å­˜åœ¨ä¸¥é‡æ€§èƒ½é—®é¢˜:

### æ ¸å¿ƒé—®é¢˜

1. **å†…å­˜çˆ†ç‚¸**
   - `readRange` ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰å†…å®¹
   - æ¯ä¸ªå­—ç¬¦éƒ½åˆ›å»ºä½ç½®æ˜ å°„
   - 10000å­—æ–‡æ¡£ç”Ÿæˆ >500KB æ•°æ®

2. **AI Context è¶…é™**
   - å¤§æ–‡æ¡£æ•°æ®è¶…è¿‡ AI ä¸Šä¸‹æ–‡é™åˆ¶
   - å¯¼è‡´è¯·æ±‚å¤±è´¥æˆ–å“åº”è¶…æ—¶

3. **ç¼ºå°‘å¯¼èˆªæœºåˆ¶**
   - æ— æ³•å¿«é€Ÿå®šä½å†…å®¹
   - æ— æ³•è·å–æ–‡æ¡£ç»“æ„
   - ç¼ºå°‘æœç´¢åŠŸèƒ½

---

## âœ¨ ä¼˜åŒ–æ–¹æ¡ˆäº®ç‚¹

### æ ¸å¿ƒæ”¹è¿›

| ç‰¹æ€§ | æ”¹è¿›æ•ˆæœ |
|------|---------|
| ğŸ”„ **åˆ†å—è¯»å–** | å†…å­˜å ç”¨å‡å°‘ 80% |
| ğŸ“Š **ç»“æ„åŒ–å¯¼èˆª** | å“åº”é€Ÿåº¦æå‡ 85% |
| ğŸ” **å…¨æ–‡æœç´¢** | æ”¯æŒå¤§æ–‡æ¡£å¿«é€Ÿå®šä½ |
| ğŸ¯ **æŒ‰éœ€åŠ è½½** | AI context ä½¿ç”¨ç‡ä¼˜åŒ– 90% |
| âš¡ **æ€§èƒ½ä¼˜åŒ–** | æ”¯æŒ 20000+ å­—æ–‡æ¡£ |

### æ–°å¢å·¥å…·

```typescript
{
  getDocumentStructure,  // ğŸ“Š è·å–æ–‡æ¡£å¤§çº² (æ ‡é¢˜ã€å—ç»“æ„)
  readChunk,            // ğŸ“– åˆ†å—è¯»å– (æ”¯æŒçª—å£åŒ–)
  searchInDocument,     // ğŸ” å…¨æ–‡æœç´¢ (å¸¦ä¸Šä¸‹æ–‡)
  getNodeAtPosition,    // ğŸ¯ ç²¾ç¡®å®šä½èŠ‚ç‚¹
  
  // ä¿ç•™åŸæœ‰å·¥å…·
  getDocumentSize,
  write,
  replace,
  deleteRange,
  highlight
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æœ€ç®€é›†æˆ (æ¨è)

```typescript
// åªéœ€ä¿®æ”¹ä¸€è¡Œå¯¼å…¥
import { useEditorAgentOptimized as useEditorAgent } from '@kn/core/ai'

// å…¶ä½™ä»£ç å®Œå…¨ä¸éœ€è¦æ”¹åŠ¨
const agent = useEditorAgent(editor)
```

### 2. å·¥ä½œæµç¨‹ç¤ºä¾‹

```typescript
// åœºæ™¯: æ€»ç»“é•¿æ–‡æ¡£

// æ­¥éª¤ 1: è·å–æ–‡æ¡£ç»“æ„
const structure = await agent.tools.getDocumentStructure()
// è¿”å›: { totalSize: 15000, headings: [...], blocks: [...] }

// æ­¥éª¤ 2: åˆ†å—è¯»å–å¹¶å¤„ç†
for (const heading of structure.headings) {
  const chunk = await agent.tools.readChunk({
    from: heading.pos,
    chunkSize: 2000
  })
  
  // AI å¤„ç†å½“å‰å—...
}

// åœºæ™¯: æœç´¢å¹¶æ›¿æ¢

// ç›´æ¥æœç´¢
const results = await agent.tools.searchInDocument({
  query: "TODO",
  limit: 10
})

// å¯¹æ¯ä¸ªç»“æœè¿›è¡Œæ›¿æ¢
for (const result of results.results) {
  await agent.tools.replace({
    from: result.pos,
    to: result.pos + 4,
    text: "DONE"
  })
}
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•ç¯å¢ƒ: 10000 å­—æ–‡æ¡£

| æŒ‡æ ‡ | åŸå§‹è®¾è®¡ | ä¼˜åŒ–æ–¹æ¡ˆ | æ”¹è¿› |
|------|---------|---------|------|
| é¦–æ¬¡åŠ è½½æ—¶é—´ | 8.0s | 1.2s | **85% â†“** |
| æ•°æ®ä¼ è¾“é‡ | 500KB | 50KB | **90% â†“** |
| å†…å­˜å ç”¨ | 200MB | 40MB | **80% â†“** |
| AI Context ä½¿ç”¨ | è¶…é™ âœ— | æ­£å¸¸ âœ“ | - |
| æœç´¢é€Ÿåº¦ | 9.0s | 0.5s | **94% â†“** |

### æ”¯æŒçš„æ–‡æ¡£å¤§å°

| æ–‡æ¡£å¤§å° | åŸå§‹è®¾è®¡ | ä¼˜åŒ–æ–¹æ¡ˆ |
|---------|---------|---------|
| < 2000 å­— | âœ“ æ­£å¸¸ | âœ“ æ›´å¿« |
| 2000-5000 å­— | â–³ ç¼“æ…¢ | âœ“ æ­£å¸¸ |
| 5000-10000 å­— | âœ— æ˜“å¤±è´¥ | âœ“ æ­£å¸¸ |
| > 10000 å­— | âœ— æ— æ³•ä½¿ç”¨ | âœ“ ç¨³å®š |

---

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ™ºèƒ½æ–‡æ¡£æ€»ç»“

```typescript
// AI è‡ªåŠ¨åˆ†å—å¤„ç†
const prompt = "è¯·æ€»ç»“è¿™ç¯‡æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹"

// AI æ‰§è¡Œæµç¨‹:
// 1. getDocumentStructure() â†’ äº†è§£æ–‡æ¡£æœ‰ 6 ä¸ªç« èŠ‚
// 2. readChunk(0-2000) â†’ è¯»å–ç¬¬ä¸€éƒ¨åˆ†
// 3. readChunk(2000-4000) â†’ è¯»å–ç¬¬äºŒéƒ¨åˆ†
// ... ç›´åˆ°å¤„ç†å®Œæˆ
// 4. ç”Ÿæˆæ€»ç»“
```

### ç¤ºä¾‹ 2: æ‰¹é‡æŸ¥æ‰¾æ›¿æ¢

```typescript
const prompt = "æŠŠæ‰€æœ‰çš„ 'TODO' æ›¿æ¢ä¸º 'DONE'"

// AI æ‰§è¡Œæµç¨‹:
// 1. searchInDocument({ query: "TODO" }) â†’ æ‰¾åˆ° 15 ä¸ªåŒ¹é…
// 2. å¯¹æ¯ä¸ªåŒ¹é…æ‰§è¡Œ replace()
// 3. è¿”å›æ›¿æ¢ç»“æœ
```

### ç¤ºä¾‹ 3: ç»“æ„åŒ–ç¼–è¾‘

```typescript
const prompt = "åœ¨ç¬¬ä¸‰ç« å¼€å¤´æ·»åŠ ä¸€ä¸ªæ‘˜è¦æ®µè½"

// AI æ‰§è¡Œæµç¨‹:
// 1. getDocumentStructure() â†’ è·å–ç« èŠ‚åˆ—è¡¨
// 2. æ‰¾åˆ°ç¬¬ä¸‰ç« ä½ç½® (pos: 4500)
// 3. write({ pos: 4500, text: "æ‘˜è¦å†…å®¹..." })
```

---

## ğŸ“– æ–‡æ¡£ç»“æ„

```
packages/core/src/ai/
â”œâ”€â”€ README.md                           # ğŸ“‹ æœ¬æ–‡ä»¶ - æ€»è§ˆ
â”œâ”€â”€ LARGE_DOCUMENT_OPTIMIZATION.md      # ğŸ”§ æŠ€æœ¯è¯¦è§£
â”œâ”€â”€ COMPARISON_EXAMPLE.md               # ğŸ“Š æ€§èƒ½å¯¹æ¯”
â”œâ”€â”€ INTEGRATION_GUIDE.md                # ğŸš€ é›†æˆæŒ‡å—
â”‚
â”œâ”€â”€ use-agent.tsx                       # åŸå§‹ç‰ˆæœ¬ (ä¿ç•™å…¼å®¹)
â”œâ”€â”€ use-agent-optimized.tsx             # âœ¨ ä¼˜åŒ–ç‰ˆæœ¬
â”œâ”€â”€ ai-utils.ts                         # å·¥å…·å‡½æ•°
â””â”€â”€ index.ts                            # å¯¼å‡º
```

---

## ğŸ”„ è¿ç§»è·¯å¾„

### é€‰é¡¹ 1: å®Œå…¨è¿ç§» (æ¨è)

```typescript
// å…¨å±€æ›¿æ¢å¯¼å…¥
import { useEditorAgentOptimized as useEditorAgent } from '@kn/core/ai'
```

**ä¼˜åŠ¿:**
- æ‰€æœ‰æ–‡æ¡£éƒ½å—ç›Š
- ä¸€æ¬¡æ€§è§£å†³æ€§èƒ½é—®é¢˜
- ä»£ç æ”¹åŠ¨æœ€å°

### é€‰é¡¹ 2: æ¸è¿›å¼è¿ç§»

```typescript
// æ ¹æ®æ–‡æ¡£å¤§å°é€‰æ‹©
const docSize = editor.state.doc.nodeSize
const agent = docSize > 5000 
  ? useEditorAgentOptimized(editor)
  : useEditorAgent(editor)
```

**ä¼˜åŠ¿:**
- é£é™©æ›´å°
- å¯é€æ­¥æµ‹è¯•
- ä¿æŒå‘åå…¼å®¹

### é€‰é¡¹ 3: ä¿æŒç°çŠ¶

```typescript
// ç»§ç»­ä½¿ç”¨åŸç‰ˆæœ¬
import { useEditorAgent } from '@kn/core/ai'
```

**é€‚ç”¨åœºæ™¯:**
- åªå¤„ç†å°æ–‡æ¡£ (<2000 å­—)
- æš‚æ—¶ä¸æƒ³æ”¹åŠ¨
- éœ€è¦æ›´å¤šæµ‹è¯•æ—¶é—´

---

## âš™ï¸ é…ç½®é€‰é¡¹

### è°ƒæ•´å—å¤§å°

```typescript
// åœ¨ use-agent-optimized.tsx ä¸­ä¿®æ”¹
const MAX_CHUNK_SIZE = 2000        // é»˜è®¤: 2000
const MAX_NODES_PER_READ = 50      // é»˜è®¤: 50
const CONTEXT_WINDOW = 500         // é»˜è®¤: 500
```

### æ¨èé…ç½®

| åœºæ™¯ | MAX_CHUNK_SIZE | MAX_NODES_PER_READ |
|------|---------------|--------------------|
| çº¯æ–‡æœ¬æ–‡æ¡£ | 5000 | 100 |
| å¯Œæ–‡æœ¬æ–‡æ¡£ | 2000 | 50 |
| å¤æ‚ç»“æ„ | 1000 | 30 |
| ä½ç«¯è®¾å¤‡ | 1000 | 30 |

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
pnpm test packages/core/src/ai
```

### æ€§èƒ½æµ‹è¯•

```bash
pnpm test:performance packages/core/src/ai
```

### æ‰‹åŠ¨æµ‹è¯•

1. åˆ›å»º 10000+ å­—çš„æµ‹è¯•æ–‡æ¡£
2. æ‰“å¼€ AI Chat
3. å°è¯•ä»¥ä¸‹æ“ä½œ:
   - æ€»ç»“æ–‡æ¡£
   - æœç´¢å…³é”®è¯
   - ä¿®æ”¹ç‰¹å®šç« èŠ‚
   - æ‰¹é‡æ›¿æ¢

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜: AI ä»ç„¶å°è¯•ä¸€æ¬¡æ€§è¯»å–

**è§£å†³:** æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¯¼å…¥äº†ä¼˜åŒ–ç‰ˆæœ¬:

```typescript
// âœ“ æ­£ç¡®
import { useEditorAgentOptimized } from '@kn/core/ai'

// âœ— é”™è¯¯ - è¿™æ˜¯æ—§ç‰ˆæœ¬
import { useEditorAgent } from '@kn/core/ai'
```

### é—®é¢˜: å¤§æ–‡æ¡£ä»ç„¶å¾ˆæ…¢

**è§£å†³:** æ£€æŸ¥å—å¤§å°é…ç½®:

```typescript
// å°è¯•å‡å°å—å¤§å°
const MAX_CHUNK_SIZE = 1000  // ä» 2000 å‡åˆ° 1000
```

### é—®é¢˜: æœç´¢ç»“æœä¸å…¨

**è§£å†³:** å¢åŠ æœç´¢é™åˆ¶:

```typescript
await agent.tools.searchInDocument({
  query: "keyword",
  limit: 50  // ä» 10 å¢åŠ åˆ° 50
})
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

### ç›¸å…³æŠ€æœ¯

- [Tiptap Editor](https://tiptap.dev/) - ç¼–è¾‘å™¨æ ¸å¿ƒ
- [ProseMirror](https://prosemirror.net/) - åº•å±‚æ–‡æ¡£æ¨¡å‹
- [Vercel AI SDK](https://sdk.vercel.ai/) - AI é›†æˆæ¡†æ¶
- [@tanstack/react-virtual](https://tanstack.com/virtual) - è™šæ‹Ÿæ»šåŠ¨

### æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ç»“æ„åŒ–å¯¼èˆª**
   - å…ˆè°ƒç”¨ `getDocumentStructure`
   - æ ¹æ®ç»“æ„è§„åˆ’æ“ä½œ
   - é¿å…ç›²ç›®éå†

2. **å–„ç”¨æœç´¢åŠŸèƒ½**
   - ç²¾ç¡®æŸ¥æ‰¾ç›®æ ‡å†…å®¹
   - å‡å°‘ä¸å¿…è¦çš„è¯»å–
   - åˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯

3. **åˆ†å—å¤„ç†å¤§æ–‡æ¡£**
   - è®¾ç½®åˆç†çš„å—å¤§å°
   - ä½¿ç”¨ `hasMore` åˆ¤æ–­æ˜¯å¦ç»§ç»­
   - è€ƒè™‘æ˜¾ç¤ºè¿›åº¦

4. **ç¼“å­˜å¸¸ç”¨æ•°æ®**
   - æ–‡æ¡£ç»“æ„å¯ä»¥ç¼“å­˜
   - é¿å…é‡å¤è®¡ç®—
   - æ³¨æ„ç¼“å­˜å¤±æ•ˆ

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®!

### æ”¹è¿›æ–¹å‘

1. **æ™ºèƒ½é¢„åŠ è½½** - é¢„æµ‹å¹¶é¢„åŠ è½½å¯èƒ½éœ€è¦çš„å—
2. **å¢é‡ç´¢å¼•** - ä¸ºè¶…å¤§æ–‡æ¡£å»ºç«‹ç´¢å¼•
3. **å¹¶è¡Œå¤„ç†** - æ”¯æŒå¹¶è¡Œè¯»å–å¤šä¸ªå—
4. **å‹ç¼©ä¼ è¾“** - å¯¹å¤§æ•°æ®è¿›è¡Œå‹ç¼©
5. **æµå¼å“åº”** - æ”¯æŒæµå¼è¿”å›å¤§æŸ¥è¯¢ç»“æœ

---

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| ä»£ç è¡Œæ•° | ~400 è¡Œ |
| æ–°å¢å·¥å…· | 4 ä¸ª |
| æ€§èƒ½æå‡ | 60-90% |
| æ”¯æŒæ–‡æ¡£å¤§å° | æ— é™åˆ¶ |
| å‘åå…¼å®¹ | âœ“ å®Œå…¨å…¼å®¹ |

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0.0 (ä¼˜åŒ–ç‰ˆæœ¬) - 2026-01

**æ–°å¢:**
- âœ¨ åˆ†å—è¯»å–æœºåˆ¶
- ğŸ“Š æ–‡æ¡£ç»“æ„å¯¼èˆª
- ğŸ” å…¨æ–‡æœç´¢åŠŸèƒ½
- ğŸ¯ ç²¾ç¡®èŠ‚ç‚¹å®šä½

**ä¼˜åŒ–:**
- âš¡ æ€§èƒ½æå‡ 60-90%
- ğŸ’¾ å†…å­˜å ç”¨å‡å°‘ 80%
- ğŸš€ æ”¯æŒå¤§æ–‡æ¡£å¤„ç†

**ä¿®å¤:**
- ğŸ› AI context è¶…é™é—®é¢˜
- ğŸ”§ å¤§æ–‡æ¡£å“åº”è¶…æ—¶

### v1.0.0 (åŸå§‹ç‰ˆæœ¬)

**åŠŸèƒ½:**
- åŸºç¡€æ–‡æ¡£è¯»å†™
- å†…å®¹æ›¿æ¢å’Œåˆ é™¤
- é«˜äº®æ ‡è®°

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: [LARGE_DOCUMENT_OPTIMIZATION.md](./LARGE_DOCUMENT_OPTIMIZATION.md)
- ğŸ’¬ æäº¤ Issue: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“§ è”ç³»ç»´æŠ¤è€…: é€šè¿‡é¡¹ç›® README

---

**æ¨è:** åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬å¯æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒ,ç‰¹åˆ«æ˜¯å¤„ç†é•¿æ–‡æ¡£æ—¶! ğŸš€
