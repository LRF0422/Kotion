version: '3.8'

services:
  # Nginx reverse proxy for HTTPS/SSL termination
  nginx:
    image: nginx:alpine
    container_name: room-server-nginx
    ports:
      - "8877:8877"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      # Mount SSL certificates
      - ./nginx/kotion.top.pem:/usr/share/nginx/kotion.top.pem
      - ./nginx/kotion.top.key:/usr/share/nginx/kotion.top.key
    restart: unless-stopped
    networks:
      - room-network

  # Room server (Hocuspocus WebSocket server)
  room-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: room-server
    environment:
      - PORT=1234
      - NODE_ENV=production
      - SSL_ENABLED=false  # SSL is handled by nginx
    # Internal port, not exposed to host
    expose:
      - "1234"
    restart: unless-stopped
    networks:
      - room-network

networks:
  room-network:
    driver: bridge
